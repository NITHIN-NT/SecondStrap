{% extends "./profile_base.html" %}
{% load static %}

{% block title %}Saved Addresses - Profile{% endblock %}

{% block profile_extra_style %}
    <link rel="stylesheet" href="{% static 'css/userprofile/profile_addresses.css' %}">
{% endblock profile_extra_style %}


{% block profile_content %}

<div class="profile-card">
    <div class="profile-card-header">
        <h2>Saved Addresses</h2>
        <a href="#" class="add-new-link" id="addNewAddress">
            <i class="bx bx-plus"></i>
            <span>Add New Address</span>
        </a>
    </div>
    {% for add in addresses %}
    <div class="profile-card-body">
        <div class="address-list">
            <div class="address-card">
                <div class="address-card-header">
                    <div class="address-card-title">
                        <h4>{{add.address_type}}</h4>
                        <span class="default-badge">{% if add.is_default %} Default {% else %}Normal{% endif %}</span>
                    </div>

                    <div class="address-card-actions">  
                        <a href="#" class="edit-address-link" data-address-id="{{ add.id }}">
                            <i class="bx bxs-pencil"></i>
                        </a>
                        <a href="{% url "delete_address" add.id %}" class="delete-address-link" data-address-id="{{ add.id }}" data-address-label="{{ add.full_name }} - {{ add.address_line_1 }}">  
                            <i class="bx bxs-trash"></i>
                        </a>
                    </div>
                </div>

                <div class="address-card-body">
                    <p>
                        {{add.full_name}}
                        {{add.address_line_1}}<br>
                        {{add.address_line_2}}<br>
                        {{add.city}},{{add.state}}
                        {{add.country}}
                    </p>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="empty-address-state">
        <div class="empty-address-content">
            <div class="empty-icon-wrapper">
                <i class="bx bx-map-alt"></i>
            </div>
            <h3>No Saved Addresses</h3>
            <p>You haven't added any shipping addresses yet. Add one to make checkout faster and easier.</p>
        </div>
    </div>
    {% endfor %}
</div>

<div id="deleteConfirmModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Delete Address</h3>
            <button class="close-modal-btn" id="closeDeleteModalBtn">&times;</button>
        </div>

        <div class="modal-body">
            <p>
                Are you sure you want to delete this address?
                <br>
                <strong id="deleteAddressLabel"></strong>
            </p>
        </div>

        <div class="modal-actions">
            <button type="button" class="cancel-btn" id="cancelDeleteBtn">Cancel</button>

            <form id="deleteAddressForm" method="POST">
                {% csrf_token %}
                <button type="submit" class="save-btn danger-btn">Yes, delete</button>
            </form>
        </div>
    </div>
</div>
<span id="fetchUrlBase" data-url-base="{% url 'fetch_address' address_id=0 %}"></span>
<div id="addressModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="addressModalTitle">Add New Address</h3> 
            <button class="close-modal-btn" id="closeAddressModalBtn">&times;</button>
        </div>
        
        <div class="modal-scroll-body" data-lenis-prevent>
            <form id="addressForm" method="POST" action='{% url "add_address" %}'>
                {% csrf_token %}
        
                <input type="hidden" name="address_id" id="address_id" value=""> 

                <div class="form-group address-type-group">
                    <label class="input-label">Address Type</label>
                    <span class="error-msg" id="error_address_type"></span>

                    <div class="radio-icon-container">
                        <input type="radio" id="type_home" name="address_type" value="HOME">
                        <label for="type_home" class="radio-icon-label">
                            <i class="bx bx-home-alt"></i> 
                            <span>Home</span>
                        </label>

                        <input type="radio" id="type_work" name="address_type" value="WORK">
                        <label for="type_work" class="radio-icon-label">
                            <i class="bx bx-building-house"></i> 
                            <span>Work/Office</span>
                        </label>
                        
                        <input type="radio" id="type_other" name="address_type" value="OTHER">
                        <label for="type_other" class="radio-icon-label">
                            <i class="bx bx-map-pin"></i> 
                            <span>Other</span>
                        </label>
                    </div>
                </div>  

                <div class="form-group">
                    <label for="full_name">Recipient Full Name</label>
                    <span class="error-msg" id="error_full_name"></span>
                    <input type="text" id="full_name" name="full_name" >
                </div>

                <div class="form-group">
                    <label for="address_line_1">Address Line 1 (House No., Street)</label>
                    <span class="error-msg" id="error_address_line_1"></span>
                    <input type="text" id="address_line_1" name="address_line_1" >
                </div>
                
                <div class="form-group">
                    <label for="address_line_2">Address Line 2 (Apartment, Landmark - *Optional*)</label>
                    <span class="error-msg" id="error_address_line_2"></span>
                    <input type="text" id="address_line_2" name="address_line_2">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="city">City/Town</label>
                        <span class="error-msg" id="error_city"></span>
                        <input type="text" id="city" name="city" >
                    </div>
                    
                    <div class="form-group">
                        <label for="state">State/Province</label>
                        <span class="error-msg" id="error_state"></span>
                        <input type="text" id="state" name="state" >
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="postal_code">Postal/ZIP Code</label>
                        <span class="error-msg" id="error_postal_code"></span>
                        <input type="text" id="postal_code" name="postal_code" pattern="\d{6}" maxlength="6" >
                    </div>

                    <div class="form-group">
                        <label for="phone_number">Phone Number</label>
                        <span class="error-msg" id="error_phone_number"></span>
                        <input type="tel" id="phone_number" name="phone_number" pattern="\d{10}" maxlength="10" >
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="country">Country</label>
                    <span class="error-msg" id="error_country"></span>
                    <input type="text" id="country" name="country" value="India" >
                </div>
                
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="is_default" name="is_default">
                    <label for="is_default">Set as default shipping address</label>
                </div>

                <div class="form-group">
                    <span class="error-msg" id="error_non_field_errors"></span>
                </div>

                <div class="modal-actions">
                    <button type="button" class="cancel-btn" id="cancelAddressBtn">Cancel</button>
                    <button type="submit" class="save-btn" id="saveAddressBtn">Save Address</button>
                </div>
            </form>
        </div>
        </div>
</div>

{% endblock profile_content %}

{% block profile_script %}
    <script src="{% static 'js/profile/profile-address.js' %}"></script>
{% endblock profile_script %}