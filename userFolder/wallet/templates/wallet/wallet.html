{% extends "userprofile/profile_base.html" %}
{% load static %}

{% block title %}My Wallet{% endblock %}

{% block profile_extra_style %}
    <link rel="stylesheet" href="{% static 'css/wallet/wallet.css' %}">
{% endblock profile_extra_style %}

{% block profile_content %}

<div class="profile-card wallet-card">
    <div class="wallet-card-header">
        <div class="wallet-info">
            <h2>Wallet</h2>
            <p>Available Balance</p>
            <span class="balance">
                {% if wallet %}
                    ₹ {{ wallet.balance|floatformat:2 }} 
                {% else %}
                    ₹ 0.00 (Wallet Not Active)
                {% endif %}
            </span>
        </div>
        {% if wallet %}
            <a href="#" class="add-money-btn"> 
                <i class='bx bx-plus'></i> Add Money
            </a>
        {% endif %}
    </div>
</div>

<div class="profile-card">
    <div class="profile-card-header">
        <h2>Transaction History</h2>
    </div>
    <div class="profile-card-body">
        <div class="table-responsive-wrapper">
            <table class="transaction-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type</th>
                        <th>Details</th> 
                        <th>Amount</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% if wallet %}
                        {% for transaction in wallet.transactions.all %}
                            {% with type_class=transaction.transaction_type|lower %}
                            <tr>
                                <td> {{ transaction.timestamp|date:"M d, Y" }}</td>
                                <td>{{ transaction.get_transaction_type_display }}</td>
                                <td>{{ transaction.description|default:"Wallet Activity" }}</td>

                                <td>
                                    <span class="amount amount-{{ type_class }}">
                                        {% if transaction.transaction_type == 'CR' %}
                                            <i class='bx bx-up-arrow-alt'></i> 
                                        {% else %}
                                            <i class='bx bx-down-arrow-alt'></i> 
                                        {% endif %}
                                        ₹ {{ transaction.amount|floatformat:2 }}
                                    </span>
                                </td>
                                <td>
                                    {# Display the human-readable status #}
                                    <span class="status status-{{ transaction.status|lower }}">
                                        <i class='bx bx-check-circle'></i> {{ transaction.get_status_display }}
                                    </span>
                                </td>
                            </tr>
                            {% endwith %}
                        {% empty %}
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 20px;">
                                    No transaction history available.
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 20px;">
                                Wallet service is currently unavailable or not active for your account.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock profile_content %}