{% extends 'adminbase.html' %} 
{% load static %}

{% block extra_css %}
<style>
    /* =========================================
   1. Main Layout & Wrapper
   ========================================= */
.admin-od-wrapper {
    padding: 30px;
    background-color: #f8fafc;
    /* Slate-50 background */
    min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    color: #334155;
}

/* Header Area */
.admin-od-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 24px;
}

.admin-od-header h1 {
    margin: 8px 0 4px 0;
    font-size: 28px;
    font-weight: 700;
    color: #0f172a;
}

/* Grid Layout: Left (Main) and Right (Sidebar) */
.admin-od-grid {
    display: grid;
    grid-template-columns: 1fr 380px;
    /* Flexible left, Fixed width right */
    gap: 24px;
    align-items: start;
}

/* Responsive: Stack on smaller screens */
@media (max-width: 1024px) {
    .admin-od-grid {
        grid-template-columns: 1fr;
    }
}

/* =========================================
   2. Card Styling
   ========================================= */
.card {
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
    padding: 24px;
    margin-bottom: 24px;
    border: 1px solid #e2e8f0;
}

.card-title {
    font-size: 16px;
    font-weight: 600;
    color: #0f172a;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* =========================================
   3. Table Styling (Order Items)
   ========================================= */
.admin-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
}

.admin-table th {
    text-align: left;
    color: #64748b;
    /* Slate-500 */
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
    padding-bottom: 12px;
    border-bottom: 2px solid #e2e8f0;
}

.admin-table td {
    padding: 16px 0;
    border-bottom: 1px solid #f1f5f9;
    vertical-align: middle;
    font-size: 14px;
}

.admin-table tr:last-child td {
    border-bottom: none;
}

/* Item Display inside table */
.item-flex {
    display: flex;
    align-items: center;
    gap: 16px;
}

.product-thumb {
    width: 56px;
    height: 56px;
    object-fit: cover;
    border-radius: 6px;
    border: 1px solid #e2e8f0;
    background-color: #f1f5f9;
}

/* =========================================
   4. Financial Summary
   ========================================= */
.info-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
    font-size: 14px;
}

.info-label {
    color: #64748b;
}

.info-val {
    font-weight: 500;
    color: #0f172a;
}

.total-row {
    border-top: 2px solid #e2e8f0;
    padding-top: 16px;
    margin-top: 16px;
    font-size: 18px;
    font-weight: 700;
}

/* =========================================
   5. Action Panel (Forms & Buttons)
   ========================================= */
.action-group {
    margin-bottom: 16px;
}

.action-label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    color: #475569;
    margin-bottom: 6px;
}

.form-select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #cbd5e1;
    border-radius: 6px;
    background-color: #f8fafc;
    font-size: 14px;
    color: #334155;
    transition: all 0.2s;
    appearance: none;
    /* Removes default arrow on some browsers */
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23334155' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 10px center;
    background-size: 16px;
}

.form-select:focus {
    outline: none;
    border-color: #0f172a;
    box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
}

.btn-update {
    width: 100%;
    background-color: #0f172a;
    /* Main Dark Color */
    color: white;
    padding: 12px;
    border: none;
    border-radius: 6px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: background-color 0.2s;
    margin-top: 8px;
}

.btn-update:hover {
    background-color: #334155;
}

/* =========================================
   6. Status Badges
   ========================================= */
.badge {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 9999px;
    /* Pill shape */
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.badge-success {
    background: #dcfce7;
    color: #15803d;
}

/* Green */
.badge-danger {
    background: #fee2e2;
    color: #b91c1c;
}

/* Red */
.badge-info {
    background: #dbeafe;
    color: #1d4ed8;
}

/* Blue */
.badge-warning {
    background: #fef3c7;
    color: #b45309;
}

/* Orange/Yellow */

/* =========================================
   7. Customer & Address Details
   ========================================= */
.customer-avatar {
    width: 40px;
    height: 40px;
    background: #f1f5f9;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #64748b;
}

/* Links */
a.back-link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    color: #64748b;
    font-weight: 500;
    transition: color 0.2s;
}

a.back-link:hover {
    color: #0f172a;
}
</style>
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
{% endblock extra_css %}

{% block content %}
<div class="admin-od-wrapper">
    
    <div class="admin-od-header">
        <div>
            <a href="#" style="text-decoration: none; color: #666; font-size: 14px;">
                <i class='bx bx-arrow-back'></i> Back to List
            </a>
            <h1 style="margin-top: 5px; font-size: 24px;">Order #{{ order.order_id }}</h1>
            <span style="color: #666; font-size: 14px;">Placed on {{ order.created_at|date:"M d, Y H:i" }}</span>
        </div>
        <div>
            {% if order.order_status == 'delivered' %}
                <span class="badge badge-success">DELIVERED</span>
            {% elif order.order_status == 'cancelled' %}
                <span class="badge badge-danger">CANCELLED</span>
            {% else %}
                <span class="badge badge-info">{{ order.get_order_status_display|upper }}</span>
            {% endif %}
        </div>
    </div>

    <div class="admin-od-grid">
        
        <div class="col-left">
            <div class="card">
                <h3 class="card-title">Order Items</h3>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Product</th>
                            <th>Unit Price</th>
                            <th>Quantity</th>
                            <th style="text-align: right;">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in order.items.all %}
                        <tr>
                            <td>
                                <div class="item-flex">
                                    {% if item.variant.product.image %}
                                        <img src="{{ item.variant.product.image.url }}" class="product-thumb">
                                    {% else %}
                                        <div class="product-thumb" style="background: #eee;"></div>
                                    {% endif %}
                                    <div>
                                        <div style="font-weight: 500;">{{ item.product_name }}</div>
                                        <div style="font-size: 12px; color: #666;">
                                            Size: {{ item.variant.size }}
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td>₹{{ item.price_at_purchase }}</td>
                            <td>x{{ item.quantity }}</td>
                            <td style="text-align: right;">₹{{ item.get_total_price }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h3 class="card-title">Order Financials</h3>
                <div class="info-row">
                    <span class="info-label">Subtotal</span>
                    <span class="info-val">₹{{ order.total_price }}</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Shipping</span>
                    <span class="info-val">₹49.00</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Tax</span>
                    <span class="info-val">₹18.00</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Discount</span>
                    <span class="info-val" style="color: green;">-₹{{ order.discount_amount }}</span>
                </div>
                <div class="info-row total-row">
                    <span class="info-label">Grand Total</span>
                    <span class="info-val">₹{{ order.final_price }}</span>
                </div>
            </div>
        </div>

        <div class="col-right">
            
            <div class="card" style="border-left: 4px solid #0f172a;">
                <h3 class="card-title"><i class='bx bx-slider-alt'></i> Update Status</h3>
                
                <form method="POST" action="#"> 
                    {% csrf_token %}
                    
                    <div class="action-group">
                        <label class="action-label">Order Status</label>
                        <select name="order_status" class="form-select">
                            {% for key, label in order_status_choices %}
                                <option value="{{ key }}" {% if order.order_status == key %}selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="action-group">
                        <label class="action-label">Payment Status</label>
                        <select name="payment_status" class="form-select">
                            {% for key, label in payment_status_choices %}
                                <option value="{{ key }}" {% if order.payment_status == key %}selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <button type="submit" class="btn-update">Update Order</button>
                </form>
            </div>

            <div class="card">
                <h3 class="card-title">Customer</h3>
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <div style="width: 40px; height: 40px; background: #eee; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <i class='bx bx-user' style="font-size: 20px; color: #666;"></i>
                    </div>
                    <div>
                        <div style="font-weight: 600;">{{ order.user.first_name }}</div>
                        <div style="font-size: 13px; color: #666;">{{ order.user.email }}</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">Shipping Address</h3>
                <p style="font-size: 14px; line-height: 1.5; color: #444;">
                    <strong>{{ order.shipping_address_name }}</strong><br>
                    {{ order.shipping_address_line_1 }}<br>
                    {{ order.shipping_city }} - {{ order.shipping_pincode }}<br>
                    {{ order.shipping_state }}<br>
                    <span style="color: #666; font-size: 13px;">Phone: {{ order.shipping_phone }}</span>
                </p>
            </div>

        </div>
    </div>
</div>
{% endblock content %}